---
tags: 
 - 数论-期望
grammar_cjkRuby: true
catalog: true
layout:  post
header-img: "img/header/P4.jpg"
preview-img: "/img/preview/P4.jpg"
---
<p style="text-align:left" align="center">
	<span style="color:blue;"><strong>标签</strong></span><span style="color:blue;"><strong>:</strong></span><span style="color:blue;"><strong>数学期望，</strong></span><span style="color:blue;"><strong>DP</strong></span>
</p>
<p align="left">
	<strong><span style="color:blue;">Description</span></strong>
</p>
<p style="background:rgb(228,240,248)" align="left">
	小 K 不慎被 LL 邪教洗脑了，洗脑程度深到他甚至想要从亚瑟王邪教中脱坑。
</p>
<p style="background:rgb(228,240,248)" align="left">
	他决定，在脱坑之前，最后再来打一盘亚瑟王。既然是最后一战，就一定要打得漂
</p>
<p style="background:rgb(228,240,248)" align="left">
	亮。众所周知，亚瑟王是一个看脸的游戏，技能的发动都是看概率的。作为一个非
</p>
<p style="background:rgb(228,240,248)" align="left">
	洲人，同时作为一个前 OIer，小 K 自然是希望最大化造成伤害的期望值。但他已
</p>
<p style="background:rgb(228,240,248)" align="left">
	经多年没写过代码，连 Spaly都敲不对了，因此，希望你能帮帮小 K，让他感受一
</p>
<p style="background:rgb(228,240,248)" align="left">
	下当欧洲人是怎样的体验。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	本题中我们将考虑游戏的一个简化版模型。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	玩家有一套卡牌，共 n张。游戏时，玩家将 n 张卡牌排列成某种顺序，排列后
</p>
<p style="background:rgb(228,240,248)" align="left">
	将卡牌按从前往后依次编号为 1 ~ &nbsp;n。本题中，顺序已经确定，即为输入的顺序。
</p>
<p style="background:rgb(228,240,248)" align="left">
	每张卡牌都有一个技能。第 i 张卡牌的技能发动概率为 pi，如果成功发动，则会对
</p>
<p style="background:rgb(228,240,248)" align="left">
	敌方造成di点伤害。也只有通过发动技能，卡牌才能对敌方造成伤害。基于现实因
</p>
<p style="background:rgb(228,240,248)" align="left">
	素以及小K非洲血统的考虑，pi不会为 0，也不会为 1，即 0 &lt; pi &lt; 1。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	一局游戏一共有 r 轮。在每一轮中，系统将从第一张卡牌开始，按照顺序依次
</p>
<p style="background:rgb(228,240,248)" align="left">
	考虑每张卡牌。在一轮中，对于依次考虑的每一张卡牌：&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	1如果这张卡牌在这一局游戏中已经发动过技能，则&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	1.1 如果这张卡牌不是最后一张，则跳过之（考虑下一张卡牌）；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	否则（是最后一张），结束这一轮游戏。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	2否则（这张卡牌在这一局游戏中没有发动过技能），设这张卡牌为第 i 张&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	2.1将其以 pi的概率发动技能。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	2.2如果技能发动，则对敌方造成 di点伤害，并结束这一轮。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	2.3如果这张卡牌已经是最后一张（即 i 等于n），则结束这一轮；否则，
</p>
<p style="background:rgb(228,240,248)" align="left">
	考虑下一张卡牌。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	请帮助小 K 求出这一套卡牌在一局游戏中能造成的伤害的期望值。&nbsp;
</p>
<p align="left">
	<strong><span style="color:blue;">Input</span></strong>
</p>
<p style="background:rgb(228,240,248)" align="left">
	输入文件的第一行包含一个整数 T，代表测试数据组数。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	接下来一共 T 组数据。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	每组数据的第一行包含两个用空格分开的整数 n和r，分别代表卡牌的张数和
</p>
<p style="background:rgb(228,240,248)" align="left">
	游戏的轮数。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	接下来 n行，每行包含一个实数和一个整数，由空格隔开，描述一张卡牌。第
</p>
<p style="background:rgb(228,240,248)" align="left">
	i 行的两个数为 pi和 di，分别代表第 i 张卡牌技能发动的概率（实数）和技能发动
</p>
<p style="background:rgb(228,240,248)" align="left">
	造成的伤害（整数）。保证 pi最多包含 4位小数，且为一个合法的概率。&nbsp;
</p>
<p align="left">
	<strong><span style="color:blue;">Output</span></strong>
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;对于每组数据，输出一行，包含一个实数，为这套卡牌在这一局游戏中造成的
</p>
<p style="background:rgb(228,240,248)" align="left">
	伤害的期望值。对于每一行输出，只有当你的输出和标准答案的相对误差不超过
</p>
<p style="background:rgb(228,240,248)" align="left">
	10^-8时——即|a-o|/a&lt;=10-8时(其中a是标准答案，o是输出)，你的输出才会被判为正确。
</p>
<p style="background:rgb(228,240,248)" align="left">
	建议输出10 位小数。&nbsp;
</p>
<p align="left">
	<strong><span style="color:blue;">Sample Input</span></strong>
</p>
<p style="background:rgb(228,240,248)" align="left">
	1 <span style="background:rgb(141,184,255)"><br />
	<br />
	</span>
</p>
<p style="background:rgb(228,240,248)" align="left">
	3 2 <span style="background:rgb(141,184,255)"><br />
	<br />
	</span>
</p>
<p style="background:rgb(228,240,248)" align="left">
	0.5000 2 <span style="background:rgb(141,184,255)"><br />
	<br />
	</span>
</p>
<p style="background:rgb(228,240,248)" align="left">
	0.3000 3 <span style="background:rgb(141,184,255)"><br />
	<br />
	</span>
</p>
<p style="background:rgb(228,240,248)" align="left">
	0.9000 1 
</p>
<p align="left">
	<strong><span style="color:blue;">Sample Output</span></strong>
</p>
<p style="background:rgb(228,240,248)" align="left">
	3.2660250000 
</p>
<p align="left">
	<strong><span style="color:blue;">HINT</span></strong>
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;一共有 13 种可能的情况：&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	1. &nbsp;第一轮中，第 1张卡牌发动技能；第二轮中，第 2张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.15，伤害为5。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	2. &nbsp;第一轮中，第 1张卡牌发动技能；第二轮中，第 3张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.315，伤害为3。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	3. &nbsp;第一轮中，第 1张卡牌发动技能；第二轮不发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.035，伤害为2。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	4. &nbsp;第一轮中，第 2张卡牌发动技能；第二轮中，第 1张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.075，伤害为5。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	5. &nbsp;第一轮中，第 2张卡牌发动技能；第二轮中，第 3张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.0675，伤害为4。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	6. &nbsp;第一轮中，第 2张卡牌发动技能；第二轮不发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.0075，伤害为3。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	7. &nbsp;第一轮中，第 3张卡牌发动技能；第二轮中，第 1张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.1575，伤害为3。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	8. &nbsp;第一轮中，第 3张卡牌发动技能；第二轮中，第 2张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.04725，伤害为4。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	9. &nbsp;第一轮中，第 3张卡牌发动技能；第二轮不发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.11025，伤害为1。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	10. &nbsp;第一轮不发动技能；第二轮中，第 1张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.0175，伤害为2。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	11. &nbsp;第一轮不发动技能；第二轮中，第 2张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.00525，伤害为3。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	12. &nbsp;第一轮不发动技能；第二轮中，第 3张卡牌发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.011025，伤害为1。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	13. &nbsp;第一轮不发动技能；第二轮亦不发动技能；&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	概率为 0.001225，伤害为0。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	造成伤害的期望值为概率与对应伤害乘积之和，为3.266025。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	对于所有测试数据， 1 &lt;= T &lt;= 444， 1 &lt;= n &lt;= 220， 0&lt;= r &lt;= 132， 0&lt; pi &lt; 1， 0 &lt;= di &lt;= 1000。 &nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	除非备注中有特殊说明，数据中 pi与di均为随机生成。&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	&nbsp;
</p>
<p style="background:rgb(228,240,248)" align="left">
	请注意可能存在的实数精度问题，并采取适当措施。&nbsp;
</p>
<p>
	&nbsp;
</p>
<p>
	分析：
</p>
<p>
	对于每一张牌，只有前面的牌会影响它的期望，后面的牌对它无影响
</p>
<p>
	所以满足DP的性质
</p>
<p>
	F[i][j]表示前i张牌，用剩j次机会的概率
</p>
<p>
	F[i][j]=f[i-1][j]*(1-p[i])^j+f[i-1][j+1]*(1-(1-p[i])^(j+1))
</p>
<p>
	前面一部分表示第i张牌没有用掉这次机会，后面表示这张牌用掉了这次机会的概率总和
</p>
<p>
	&nbsp;
</p>
<p>
	Code
</p>
<pre name="code" class="cpp">#include&lt;iostream&gt;
#include&lt;cstdio&gt;
#include&lt;cstdlib&gt;
#include&lt;cstring&gt;
#include&lt;cmath&gt;
#include&lt;algorithm&gt;
#define rep(i,a,b) for(int i=a;i&lt;=b;i++)
#define dep(i,a,b) for(int i=a;i&gt;=b;i--)
#define ll long long
#define mem(x,num) memset(x,num,sizeof x)
#ifdef WIN32
#define LL &quot;%I64d\n&quot;
#else
#define LL &quot;%lld\n&quot;
#endif
using namespace std;
inline ll read()
{
	ll f=1,x=0;char ch=getchar();
	while(ch&lt;'0'||ch&gt;'9'){if(ch=='-')f=-1;ch=getchar();}
	while(ch&gt;='0'&amp;&amp;ch&lt;='9'){x=x*10+ch-'0';ch=getchar();}
	return x*f;
}
const int maxn=306;
double p[maxn],pw[maxn][maxn],f[maxn][maxn],ans=0.0;
int a[maxn],T,n,r;

int main()
{
	T=read();
	while(T--){
		n=read(),r=read();
		rep(i,1,n){
			cin&gt;&gt;p[i]&gt;&gt;a[i];
			p[i]=1-p[i];
		}
		rep(i,1,n){
			pw[i][0]=1.0;
			rep(j,1,r)pw[i][j]=pw[i][j-1]*p[i];
		}
		mem(f,0);
		f[0][r]=1.0;ans=0.0;
		rep(i,1,n){
			double s=0.0;
			dep(j,r,0){
			    f[i][j]=f[i-1][j]*pw[i][j]+f[i-1][j+1]*(1-pw[i][j+1]);
			    s+=f[i-1][j+1]*(1-pw[i][j+1]);
			}
			ans+=s*double(a[i]);
		}
		printf(&quot;%.10lf\n&quot;,ans);
	}
	return 0;
}</pre>
<br />
<br />

<p>
	<br />
	
</p>
